{# Copyright (c) 2015 Jessica Tallon & Matt Molyneaux. This file is part of Inboxen. Licensed under the terms of the GNU AGPL, as published by the FSF, version 3 the or later #}
{% extends 'base.html' %}
{% load i18n inboxen_flags %}

{% if inbox %}
    {% url 'single-inbox' inbox=inbox domain=domain as inbox_url %}
{% else %}
    {% url 'unified-inbox' as inbox_url %}
{% endif %}

{% block breadcumbs %}
    <ul class="breadcrumb">
        <li><a href="{% url 'user-home' %}">{% blocktrans %} {{ user }}'s Home {% endblocktrans %}</a></li>
        {% if inbox %}
            <li class="active">{{ inbox }}@{{ domain }}</li>
        {% else %}
            <li class="active">{% trans "Unified Inbox" %}</li>
        {% endif %}
    </ul>
{% endblock %}

{% block content %}
<form id="email-list" action="{{ request.path }}" method="POST" data-url="{% url 'form-inbox-email' %}">
    {% csrf_token %}
    <button class="btn btn-default" type="submit" name="important">{% trans "Important" %}</button>
    <button class="btn btn-default" type="submit" name="unimportant">{% trans "Unimportant" %}</button>
    <button class="btn btn-default" type="submit" name="delete">{% trans "Delete" %}</button>
    <div class="honeydew">
        {% for email in page_obj.object_list %}
            <div id="email-{{ email.eid }}" class="row">
                <div class="col-xs-2">
                    <div class="row">
                        <div class="email-checkbox col-xs-4"><input type="checkbox" value="email" name="{{ email.eid }}" /></div>
                        <div class="email-flags col-xs-8">{{ email.flags|render_flags }}</div>
                    </div>
                </div>
                <div class="email-sender col-xs-5 col-md-3">{{ email.sender }}</div>
                {% url 'email-view' inbox=email.inbox.inbox domain=email.inbox.domain.domain id=email.eid as email_url %}
                <div title="{{ email.received_date|date:"r" }}" class="email-reveived col-xs-3 col-md-1 col-md-push-5"><div>{{ email.timesince }} {% trans "ago" %}</div></div>
                <div class="email-buttons col-xs-2 col-md-1 col-md-push-5">
                    <button title="{% trans "Toggle Importantance" %}" class="close" type="submit" name="important-single" value="{{ email.eid }}">
                        <span class="glyphicon glyphicon-star" aria-hidden="true"></span><span class="sr-only">{% trans "Toggle Importantance" %}</span>
                    </button>
                    <button title="{% trans "Delete" %}" class="close" type="submit" name="delete-single" value="{{ email.eid }}">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span><span class="sr-only">{% trans "Delete" %}</span>
                    </button>
                    {% if not inbox %}
                        <a class="close" title="{% trans "Inbox" %}" href="{% url 'single-inbox' inbox=email.inbox.inbox domain=email.inbox.domain.domain %}">
                            <span class="glyphicon glyphicon-inbox" aria-hidden="true"></span><span class="sr-only">{% trans "Inbox" %}</span>
                        </a>
                    {% endif %}
                </div>
                <div class="email-subject col-xs-12 col-md-5 col-md-pull-2">{% if email.subject %}
                    <a href="{{ email_url }}"> {{ email.subject }} </a>
                {% else %}
                    <i><a href="{{ email_url }}">{% trans "No Subject" %}</a></i>
                {% endif %}</div>
            </div>
        {% empty %}
            <div>
                <div class="col-xs-12">{% blocktrans %}This Inbox is <span title="The opposite of full.">empty</span>.{% endblocktrans %}</div>
            </div>
        {% endfor %}
    </div>
</form>
<ul class="pager">
    {% if page_obj.has_previous %}
        <li class="previous"><a href="{{ inbox_url }}{{ page_obj.previous_page_number }}/">
            <span aria-hidden="true">&laquo;</span><span class="sr-only">{% trans "Previous" %}</span>
        </a></li>
    {% endif %}

    {% if page_obj.has_next %}
        <li class="next"><a href="{{ inbox_url }}{{ page_obj.next_page_number }}/">
            <span aria-hidden="true">&raquo;</span><span class="sr-only">{% trans "Next" %}</span>
        </a></li>
    {% endif %}
</ul>
{% endblock %}
